# This file contains basic Makefile includes that contain all building
# instructions for all binaries and packages.

.PHONY: all build-setup build-clean build-directories build-headers build-objects build-xpts build-flash build-min-js build-libraries build-executables clean clean-objects clean-libraries clean-executables clean-flash clean-min-js clean-xpts

all: build-headers build-objects build-libraries build-executables build-flash build-min-js build-xpts

BUILD_FOR_LINUX=@BUILD_FOR_LINUX@
BUILD_FOR_WINDOWS=@BUILD_FOR_WINDOWS@
BUILD_FOR_MACOS=@BUILD_FOR_MACOS@

AR_FLAGS = cr
MONARCH = $(realpath @MONARCH_DIR@)
BITMUNK = $(realpath @BITMUNK_DIR@)
INCLUDES = \
	-I$(MONARCH)/dist/include \
	-I$(BITMUNK)/dist/include \
	-I$(BITMUNK)/dist/internal/include

CWD = $(shell pwd)
ifndef HEADER_DIST_DIR
HEADER_DIST_DIR = dist/include/bitmunk/$(notdir $(CWD))
endif

# Platform agnostic variables
XPIDL = @XPIDL@

# Build rules common to each platform
ifdef PRINT_COMMANDS
PCMD=
else
PCMD=@
endif

.SECONDEXPANSION:

# Build rules specific to each platform

ifeq ($(BUILD_FOR_LINUX),yes)
include @BITMUNK_DIR@/setup/Makefile.linux
endif
ifeq ($(BUILD_FOR_MACOS),yes)
include @BITMUNK_DIR@/setup/Makefile.macos
endif
ifeq ($(BUILD_FOR_WINDOWS),yes)
include @BITMUNK_DIR@/setup/Makefile.mingw32
endif

build-setup:

build-clean:

$(ALL_DIRECTORIES):
	mkdir -p $@

clean: build-clean clean-objects clean-libraries clean-executables clean-flash clean-min-js clean-xpts

build-headers: $(ALL_HEADERS)

build-objects: $(ALL_DIRECTORIES) $(ALL_SOURCES) $(ALL_OBJECTS)

build-libraries: $(ALL_DIRECTORIES) $(ALL_LIBRARIES)

build-executables: $(ALL_DIRECTORIES) $(ALL_EXECUTABLES)

build-flash: $(ALL_DIRECTORIES) $(ALL_FLASH)

build-min-js: $(ALL_DIRECTORIES) $(ALL_MIN_JS)

build-xpts: $(ALL_DIRECTORIES) $(ALL_GENERATED_HEADERS) $(ALL_XPTS)

clean-objects:
	$(PCMD) rm -rf $(LIBRARY_OBJECTS) $(EXECUTABLE_OBJECTS)

clean-libraries:
	$(PCMD) rm -rf $(LIBRARIES)

clean-executables:
	$(PCMD) rm -rf $(ALL_EXECUTABLES)

clean-flash:
	$(PCMD) rm -rf $(ALL_FLASH)

clean-min-js:
	$(PCMD) rm -rf $(ALL_MIN_JS)

clean-xpts:
	$(PCMD) rm -rf $(ALL_GENERATED_HEADERS) $(ALL_XPTS)
