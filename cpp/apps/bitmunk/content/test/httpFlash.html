<html>
   <head>
      <script type="text/javascript" src="/bitmunk/js/swfobject/swfobject.js"></script>
      
      <script type="text/javascript">
      var flashvars = {};
      var params = {};
      var attributes = {};
      
      params.allowscriptaccess = "always";
      
      swfobject.embedSWF(
         "/bitmunk/HttpPoolManager.swf", "httpPoolManager", "400", "224", "9.0.0",
         "/bitmunk/js/swfobject/expressInstall.swf", flashvars, params, attributes);
      
      var poolId = '0';
      
      /*
      function hpm_echo()
      {
         var bar = document.getElementById('foo').value;
         var str;
         if(bar != null && bar !== 'undefined' && bar != '')
         {
            str = document.getElementById('httpPoolManager').echo(bar);
         }
         else
         {
            str = document.getElementById('httpPoolManager').echo('none');
         }
         document.getElementById('feedback').innerHTML = '"' + str + '"';
         return false;
      }
      */
      
      function hpm_init()
      {
         document.getElementById('httpPoolManager').init({
            escapeForJavascript: true,
            marshallExceptions: false
         });
         document.getElementById('feedback').innerHTML =
            'HttpPoolManager initialized';
         return false;
      }
      
      function hpm_cleanup()
      {
         document.getElementById('httpPoolManager').cleanup();
         document.getElementById('feedback').innerHTML =
            'HttpPoolManager cleaned up';
         return false;
      }
      
      function hpm_create()
      {
         poolId = document.getElementById('httpPoolManager').create(
            'http://localhost:19300', 1, 19845, [
            '-----BEGIN CERTIFICATE-----\r\n' +
            'MIIDBDCCAm2gAwIBAAIBADANBgkqhkiG9w0BAQUFADCByDErMCkGA1UEAxMiYml0\r\n' +
            'bXVuay1wZWVyIENlcnRpZmljYXRlIEF1dGhvcml0eTFFMEMGA1UECxM8Qml0bXVu\r\n' +
            'ayBFbmNyeXB0aW9uLU9ubHkgQ2VydGlmaWNhdGVzIC0gQXV0aG9yaXphdGlvbiB2\r\n' +
            'aWEgQlRQMR0wGwYDVQQKExREaWdpdGFsIEJhemFhciwgSW5jLjELMAkGA1UEBhMC\r\n' +
            'VVMxEzARBgNVBAcTCkJsYWNrc2J1cmcxETAPBgNVBAgTCFZpcmdpbmlhMB4XDTA5\r\n' +
            'MDYwMzE3NDcxNloXDTI5MDUzMDE3NDcxNlowgcgxKzApBgNVBAMTImJpdG11bmst\r\n' +
            'cGVlciBDZXJ0aWZpY2F0ZSBBdXRob3JpdHkxRTBDBgNVBAsTPEJpdG11bmsgRW5j\r\n' +
            'cnlwdGlvbi1Pbmx5IENlcnRpZmljYXRlcyAtIEF1dGhvcml6YXRpb24gdmlhIEJU\r\n' +
            'UDEdMBsGA1UEChMURGlnaXRhbCBCYXphYXIsIEluYy4xCzAJBgNVBAYTAlVTMRMw\r\n' +
            'EQYDVQQHEwpCbGFja3NidXJnMREwDwYDVQQIEwhWaXJnaW5pYTCBnTANBgkqhkiG\r\n' +
            '9w0BAQEFAAOBiwAwgYcCgYEAwBDkqtqiOMv76Fey9dnv40Z381+otWFUEyQVJIUJ\r\n' +
            '3fwzBMn9NobkKM84r/0Wtz99qttdfAA7/ZJ5hORbI3aCyeJbM/ua+YgCo8n4RkIn\r\n' +
            'o9cUeRavqBhpoKK3AQK8MIODSVpjEkECmtS/xbH8912K2/+B6nZgKq6l+Q8FpNU5\r\n' +
            '1SUCAQMwDQYJKoZIhvcNAQEFBQADgYEAmSGMss3oulT6UwA/7rYWzMf/zaN9UoYO\r\n' +
            'V59m79RCJDQT8LmBeIXRGlSl1e3RdXK+zFzXNvoGBqcNJaoszaMgChlbHgYKpak7\r\n' +
            'aPvOqAe+KeFz7hRPtDL/YWC4ZuMsai6GwVtKUXfozXUa74s+yvepJmRakAlDLMMj\r\n' +
            'fw6++JtKKX0=\r\n' +
            '-----END CERTIFICATE-----'
            ], 'bitmunk/1');
         document.getElementById('feedback').innerHTML =
            'Pool ID: ' + poolId;
         return false;
      }
      
      function hpm_destroy()
      {
         document.getElementById('httpPoolManager').destroy(poolId);
         document.getElementById('feedback').innerHTML = 
            'Pool ' + poolId + ' destroyed';
         return false;
      }
      
      function opened(e)
      {
         console.log('connection opened: ', e);
      }
      
      function requestSent(e)
      {
         console.log('request sent: ', e);
      }
      
      function headerReceived(e)
      {
         console.log('header received: ', e);
      }
      
      function bodyReceived(e)
      {
         console.log('body received: ', e);
      }
      
      function hpm_subscribe()
      {
         var hpm = document.getElementById('httpPoolManager');
         var fb = document.getElementById('feedback');
         hpm.subscribe('open', 'connectionOpened');
         hpm.subscribe('request', 'requestSent');
         hpm.subscribe('header', 'headerReceived');
         hpm.subscribe('body', 'bodyReceived');
         fb.innerHTML = 'Subscribed to events'
         return false;
      }

      function hpm_setCookie()
      {
         var hpm = document.getElementById('httpPoolManager');
         hpm.setCookie(poolId, 'test', 'myvalue');
         return false;
      }
      
      function hpm_queue()
      {
         var request =
         {
            method: 'POST',
            url: '/api/3.0/system/test/echo',
            requestHeaders:
            [
               {
                  name: 'Content-Type',
                  value: 'application/x-www-form-urlencoded'
               },
            ],
            data:
            {
               echo: 'foo'
            }
         };
         
         document.getElementById('httpPoolManager').queue(
            poolId, request);
         document.getElementById('feedback').innerHTML = 
            'HTTP request queued for delivery';
         return false;
      }
      
      </script>
   </head>
   <body>
      <div id="httpPoolManager">
         <p>Could not load the flash HttpPoolManager.</p>
      </div>
      <p>Use the controls below to test the HttpPoolManager.</p>
      <div id="controls">
         <!-- <button id="echo" onclick="javascript:return hpm_echo();">echo</button> -->
         <button id="init" onclick="javascript:return hpm_init();">init</button>
         <button id="cleanup" onclick="javascript:return hpm_cleanup();">cleanup</button>
         <button id="create" onclick="javascript:return hpm_create();">create pool</button>
         <button id="destroy" onclick="javascript:return hpm_destroy();">destroy pool</button>
         <button id="subscribe" onclick="javascript:return hpm_subscribe();">subscribe</button>
         <button id="setcookie" onclick="javascript:return hpm_setCookie();">set cookie</button>
         <button id="queue" onclick="javascript:return hpm_queue();">queue</button>
      </div>
      <p>Feedback from the flash HttpPoolManager:</p>
      <div id="feedback">
      None
      </div>
      <!-- <textarea id="foo" cols=80 rows=5></textarea> -->
   </body>
</html>
