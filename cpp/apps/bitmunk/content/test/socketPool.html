<html>
   <head>
      <style> 
      canvas {
        background: black;
      }
      </style> 
      <script type="text/javascript" src="/bitmunk/js/swfobject/swfobject.js"></script>
      
      <script type="text/javascript">
      var flashvars = {};
      var params = {};
      var attributes = {};
      
      params.allowscriptaccess = "always";
      
      swfobject.embedSWF(
         "/bitmunk/SocketPool.swf", "socketPool", "400", "224", "9.0.0",
         "/bitmunk/js/swfobject/expressInstall.swf",
         flashvars, params, attributes);

      var socketId = '0';
      
      function sp_init()
      {
         document.getElementById('socketPool').init();
         document.getElementById('feedback').innerHTML =
            'SocketPool initialized';
         return false;
      }
      
      function sp_cleanup()
      {
         document.getElementById('socketPool').cleanup();
         document.getElementById('feedback').innerHTML =
            'SocketPool cleaned up';
         return false;
      }
      
      function sp_create()
      {
         socketId = document.getElementById('socketPool').create();
         document.getElementById('feedback').innerHTML =
            'Socket ID: ' + socketId;
         return false;
      }
      
      function sp_destroy()
      {
         document.getElementById('socketPool').destroy(socketId);
         document.getElementById('feedback').innerHTML = 
            'Socket ' + socketId + ' destroyed';
         return false;
      }

      function sp_connect()
      {
         document.getElementById('socketPool').connect(
            socketId, 'localhost', 19300, 19845);
      }

      function sp_send()
      {
         var req = "GET /bitmunk HTTP/1.0\r\n\r\n";
         var bytes = [];
         for(var i = 0; i < req.length; i++)
         {
            bytes.push(req.charCodeAt(i));
         }
         document.getElementById('socketPool').send(socketId, bytes);
      }

      function sp_close()
      {
         document.getElementById('socketPool').close(socketId);
      }
      
      function connected(e)
      {
         console.log('connected', e);
      }
      
      function dataReceived(bytes)
      {
         console.log('data received', bytes);
         var str = '';
         for(var i = 0; i < bytes.length; i++)
         {
            str += String.fromCharCode(bytes[i]);
         }
         console.log(str);
      }
      
      function ioError(e)
      {
         console.log('ioError', e);
      }

      function ioError(e)
      {
         console.log('securityError', e);
      }
      
      function sp_subscribe()
      {
         var sp = document.getElementById('socketPool');
         var fb = document.getElementById('feedback');
         sp.subscribe('connect', 'connected');
         sp.subscribe('socketData', 'dataReceived');
         sp.subscribe('ioError', 'ioError');
         sp.subscribe('securityError', 'securityError');
         fb.innerHTML = 'Subscribed to events'
         return false;
      }

      </script>
   </head>
   <body>
      <div id="socketPool">
         <p>Could not load the flash SocketPool.</p>
      </div>
      <p>Use the controls below to test the SocketPool.</p>
      <div id="controls">
         <button id="init" onclick="javascript:return sp_init();">init</button>
         <button id="cleanup" onclick="javascript:return sp_cleanup();">cleanup</button>
         <button id="create" onclick="javascript:return sp_create();">create socket</button>
         <button id="destroy" onclick="javascript:return sp_destroy();">destroy socket</button>
         <button id="subscribe" onclick="javascript:return sp_subscribe();">subscribe</button>
         <button id="connect" onclick="javascript:return sp_connect();">connect</button>
         <button id="send" onclick="javascript:return sp_send();">send</button>
         <button id="close" onclick="javascript:return sp_close();">close</button>
      </div>
      <p>Feedback from the flash SocketPool:</p>
      <div id="feedback">
      None
      </div>
   </body>
</html>
